generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  CUSTOMER
}

// user model
model User {
  id           String   @id @default(uuid()) @db.Uuid
  email        String   @unique @db.VarChar(255)
  firstName    String   @db.VarChar(255)
  lastName     String   @db.VarChar(255)
  passwordHash String   @db.VarChar(255)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  role UserRole @default(CUSTOMER)
  carts Cart[]
  // userAddresses UserAddress[]
}

// category model
model Category {
  id          String   @id @default(uuid()) @db.Uuid
  name        String    @db.VarChar(255)
  slug        String  @unique @db.VarChar(255)
  description String
  imageUrl    String  @db.VarChar(255)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parentId    String?  @db.Uuid
  parent      Category? @relation("CategoryToSubcategories", fields: [parentId], references: [id], onDelete: Cascade)
  subcategories Category[] @relation("CategoryToSubcategories")

  products Product[]

}

// product model
model Product {
  id             String   @id @default(uuid()) @db.Uuid()
  categoryId     String   @db.Uuid()
  title          String   @db.VarChar(255)
  slug           String  @unique @db.VarChar(255)
  description    String
  basePrice      Decimal  @db.Decimal(10, 2)
  originalPrice  Decimal? @db.Decimal(10, 2)
  stockQuantity  Int      @default(0)
  specifications Json?
  isFeatured     Boolean  @default(false)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  category Category         @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  images   ProductImage[]
  variants ProductVariant[]
  cartItems CartItem[]

}

// product image model
model ProductImage {
  id           String   @id @default(uuid()) @db.Uuid()
  productId    String   @db.Uuid()
  imageUrl     String   @db.VarChar(255)
  altText      String?  @db.VarChar(255)
  displayOrder Int      @default(0)
  isPrimary    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// product variant model
model ProductVariant {
  id              String   @id @default(uuid()) @db.Uuid()
  productId       String   @db.Uuid()
  variantName     String   @db.VarChar(255)
  variantValue    String   @db.VarChar(255)
  priceAdjustment Decimal  @default(0.00) @db.Decimal(10, 2)
  stockQuantity   Int      @default(0)
  imageUrl        String?  @db.VarChar(255)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  cartItems CartItem[]
}

// cart model
model Cart {
  id        String   @id @default(uuid()) @db.Uuid()
  userId    String?  @db.Uuid()
  sessionId String?   @db.VarChar(255)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User? @relation(fields: [userId], references: [id], onDelete: Cascade)
  items CartItem[]
}

// cart item model
model CartItem {
  id        String   @id @default(uuid()) @db.Uuid()
  cartId    String   @db.Uuid()
  productId String   @db.Uuid()
  variantId String?  @db.Uuid()
  quantity  Int      @default(1)
  addedAt   DateTime @default(now())  

  cart Cart @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

}